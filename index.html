<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LaTeX to Markdown Converter</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
        textarea { width: 80%; height: 150px; margin-bottom: 10px; }
        button { padding: 10px; cursor: pointer; }
        pre { background: #f4f4f4; padding: 10px; width: 80%; margin: auto; text-align: left; }
    </style>
</head>
<body>
    <h2>LaTeX to Markdown Converter</h2>
    <textarea id="latexInput" placeholder="Enter LaTeX code here..."></textarea><br>
    <button onclick="convert()">Convert</button>
    <h3>Markdown Output:</h3>
    <pre id="markdownOutput"></pre>

    <script>
        function convert() {
            let latex = document.getElementById("latexInput").value;

            // Remove LaTeX document class and package declarations
            latex = latex.replace(/\\documentclass.*?\n/g, '')
                .replace(/\\usepackage.*?\n/g, '')
                .replace(/\\begin\{document\}/g, '')
                .replace(/\\end\{document\}/g, '');

            // Handle title, author, and date
            let title = '', author = '', date = '';
            const titleMatch = latex.match(/\\title\{(.*?)\}/);
            const authorMatch = latex.match(/\\author\{(.*?)\}/);
            const dateMatch = latex.match(/\\date\{(.*?)\}/);

            if (titleMatch) {
                title = `# ${titleMatch[1]}\n\n`;
                latex = latex.replace(/\\title\{.*?\}/, '');
            }
            if (authorMatch) {
                author = `*${authorMatch[1]}*\n\n`;
                latex = latex.replace(/\\author\{.*?\}/, '');
            }
            if (dateMatch) {
                date = `*${dateMatch[1]}*\n\n`;
                latex = latex.replace(/\\date\{.*?\}/, '');
            }

            // Remove \maketitle
            latex = latex.replace(/\\maketitle/, '');

            // Convert the rest of the document
            let markdown = latex
                // Headers
                .replace(/\\chapter\{(.*?)\}/g, '# $1\n')
                .replace(/\\section\{(.*?)\}/g, '# $1\n')
                .replace(/\\subsection\{(.*?)\}/g, '## $1\n')
                .replace(/\\subsubsection\{(.*?)\}/g, '### $1\n')
                .replace(/\\paragraph\{(.*?)\}/g, '#### $1\n')

                // Text formatting
                .replace(/\\textbf\{(.*?)\}/g, '**$1**')
                .replace(/\\textit\{(.*?)\}/g, '*$1*')
                .replace(/\\emph\{(.*?)\}/g, '*$1*')
                .replace(/\\underline\{(.*?)\}/g, '_$1_')

                // Lists
                .replace(/\\begin\{itemize\}/g, '')
                .replace(/\\end\{itemize\}/g, '')
                .replace(/\\begin\{enumerate\}/g, '')
                .replace(/\\end\{enumerate\}/g, '')
                .replace(/\\item\s+(.*?)(?=\\item|\\end\{|$)/g, '- $1\n')

                // Links and references
                .replace(/\\href\{(.*?)\}\{(.*?)\}/g, '[$2]($1)')
                .replace(/\\url\{(.*?)\}/g, '<$1>')
                .replace(/\\cite\{(.*?)\}/g, '[@$1]')

                // Math mode
                .replace(/\$\$(.*?)\$\$/g, '\n```math\n$1\n```\n')
                .replace(/\$(.*?)\$/g, '`$1`')
                .replace(/\\begin\{equation\}([\s\S]*?)\\end\{equation\}/g, '\n```math\n$1\n```\n')
                .replace(/\\begin\{align\*?\}([\s\S]*?)\\end\{align\*?\}/g, '\n```math\n$1\n```\n')

                // Tables
                .replace(/\\begin\{tabular\}(\{.*?\})([\s\S]*?)\\end\{tabular\}/g, (match, columns, content) => {
                    const rows = content.trim().split('\\\\');
                    const table = rows.map(row => {
                        return '| ' + row.trim().split('&').map(cell => cell.trim()).join(' | ') + ' |';
                    });
                    const headerSeparator = '| ' + columns.replace(/[^c|l|r]/g, '').split('').map(() => '---').join(' | ') + ' |';
                    return '\n' + table[0] + '\n' + headerSeparator + '\n' + table.slice(1).join('\n') + '\n';
                })

                // Figures and images
                .replace(/\\includegraphics(\[.*?\])?\{(.*?)\}/g, '![]($2)')
                .replace(/\\caption\{(.*?)\}/g, '*$1*')

                // Clean up
                .replace(/\\newline/g, '\n')
                .replace(/\\\\(\n)?/g, '\n')
                .replace(/\n\n+/g, '\n\n')
                .trim();

            // Combine all elements
            markdown = title + author + date + markdown;

            // Display the converted Markdown
            document.getElementById("markdownOutput").innerText = markdown || "Conversion failed";
        }
    </script>
</body>
</html>
